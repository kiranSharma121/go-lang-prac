<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Go WebSocket Chat</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      #chat-box {
        border: 1px solid #ccc;
        height: 300px;
        overflow-y: auto;
        padding: 10px;
        margin-bottom: 10px;
      }
      #message {
        width: 80%;
        padding: 5px;
      }
      #send {
        padding: 5px 10px;
      }
    </style>
  </head>
  <body>
    <h2>WebSocket Chat</h2>
    <div>
      <label>User ID: </label>
      <input type="text" id="userId" placeholder="Enter your user id" />
      <button onclick="connect()">Connect</button>
    </div>

    <div id="chat-box"></div>

    <input type="text" id="message" placeholder="Type a message..." />
    <button id="send" onclick="sendMessage()">Send</button>

    <script>
      let socket;

      function connect() {
        const userId = document.getElementById("userId").value;
        if (!userId) {
          alert("Enter a user ID first!");
          return;
        }

        socket = new WebSocket(`ws://localhost:8080/ws/chat?user_id=${userId}`);

        socket.onopen = () => {
          addMessage(`✅ Connected as User ${userId}`);
        };

        socket.onmessage = (event) => {
          addMessage(event.data);
        };

        socket.onclose = () => {
          addMessage("❌ Disconnected from server");
        };

        socket.onerror = (error) => {
          console.error("WebSocket error:", error);
        };
      }

      function sendMessage() {
        const msg = document.getElementById("message").value;
        if (socket && socket.readyState === WebSocket.OPEN) {
          socket.send(msg);
          document.getElementById("message").value = "";
        } else {
          alert("Not connected to server!");
        }
      }

      function addMessage(msg) {
        const chatBox = document.getElementById("chat-box");
        chatBox.innerHTML += msg + "<br/>";
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    </script>
  </body>
</html>
